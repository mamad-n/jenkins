node {

    checkout scm
    stage ('build image') {
        def my_image
        my_image = 'localhost:5000/my-app-man:3.4'
        sh "docker build -t $my_image . && \
            docker image push $my_image && \
            echo done ......... "
    }

    docker.withRegistry('http://localhost:5000'){
        docker.image('ngin:23.1').withRun {

            sh 'echo hello form with run .'

            docker.image('my-app-man:3.4').inside{

                stage('Build') {
                sh 'echo from build'
                sh 'echo you branch is -- $env.BRANCH_NAME'
                sh 'echo you branch is -- $BRANCH_NAME'
                sh 'ls -lah'
                sh 'pwd'
                sh 'sleep 30'
                }

            }
        }
    }
}

